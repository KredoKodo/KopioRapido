<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:KopioRapido.ViewModels"
             xmlns:models="clr-namespace:KopioRapido.Models"
             x:Class="KopioRapido.MainPage"
             Title="KopioRapido - High-Speed File Copy"
             x:DataType="viewmodels:MainViewModel">

    <Grid RowDefinitions="Auto,*,Auto,Auto,Auto,Auto,Auto" Padding="20">

        <!-- Title -->
        <Label Grid.Row="0"
               Text="KopioRapido"
               FontSize="32"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,0,0,20"/>

        <!-- Dual Pane for Source and Destination (Hidden during copy) -->
        <Grid Grid.Row="1" ColumnDefinitions="*,250,*" Margin="0,0,0,20" IsVisible="{Binding IsCopying, Converter={StaticResource InverseBoolConverter}}">

            <!-- Source Pane -->
            <Border x:Name="SourceBorder"
                    Grid.Column="0"
                    BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                    Stroke="{AppThemeBinding Light=#0078D4, Dark=#60A5FA}"
                    StrokeThickness="2"
                    Padding="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                <!-- Drag-drop handled by native Windows implementation in code-behind -->

                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Header -->
                    <Grid Grid.Row="0"
                          BackgroundColor="{AppThemeBinding Light=#0078D4, Dark=#1E3A8A}"
                          Padding="15,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Label Grid.Column="0"
                               Text="SOURCE FILES"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="White"/>
                        <Label Grid.Column="1"
                               Text="{Binding SourcePaneHeader}"
                               FontSize="12"
                               TextColor="White"
                               VerticalOptions="Center"/>
                    </Grid>

                    <!-- File List or Empty State -->
                    <Grid Grid.Row="1">
                        <!-- Empty State -->
                        <VerticalStackLayout IsVisible="{Binding SourceFiles.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=inverse}"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Padding="20">
                            <Label Text="ðŸ“"
                                   FontSize="48"
                                   HorizontalOptions="Center"
                                   Margin="0,0,0,10"/>
                            <Label Text="Drag &amp; Drop Source Files/Folders Here"
                                   FontSize="16"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"/>
                            <Label Text="or"
                                   FontSize="14"
                                   HorizontalOptions="Center"
                                   Margin="0,5,0,5"
                                   TextColor="{AppThemeBinding Light=#888888, Dark=#AAAAAA}"/>
                            <Button Text="Select Source Folder"
                                    Command="{Binding SelectSourceCommand}"
                                    HorizontalOptions="Center"
                                    BackgroundColor="{AppThemeBinding Light=#0078D4, Dark=#60A5FA}"
                                    TextColor="White"/>
                        </VerticalStackLayout>

                        <!-- File List -->
                        <ScrollView VerticalScrollBarVisibility="Default"
                                    HorizontalScrollBarVisibility="Never"
                                    IsVisible="{Binding SourceFiles.Count, Converter={StaticResource CountToVisibilityConverter}}">
                            <CollectionView ItemsSource="{Binding SourceFiles}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:FileItem">
                                        <Border BackgroundColor="{AppThemeBinding Light=#F9F9F9, Dark=#2A2A2A}"
                                                Margin="5,2"
                                                Padding="10,8">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="4"/>
                                            </Border.StrokeShape>
                                            <Grid ColumnDefinitions="*,Auto,80" RowDefinitions="Auto,Auto">
                                                <!-- File Name -->
                                                <Label Grid.Column="0" Grid.Row="0"
                                                       Text="{Binding FileName}"
                                                       FontSize="13"
                                                       LineBreakMode="TailTruncation"
                                                       VerticalOptions="Center"/>

                                                <!-- File Size -->
                                                <Label Grid.Column="1" Grid.Row="0"
                                                       Text="{Binding FormattedSize}"
                                                       FontSize="11"
                                                       TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                                                       VerticalOptions="Center"
                                                       Margin="10,0"/>

                                                <!-- Progress Percentage or Retry Status -->
                                                <Label Grid.Column="2" Grid.Row="0"
                                                       Text="{Binding Progress, StringFormat='{0:F0}%'}"
                                                       FontSize="11"
                                                       TextColor="{AppThemeBinding Light=#0078D4, Dark=#60A5FA}"
                                                       HorizontalOptions="End"
                                                       VerticalOptions="Center"
                                                       IsVisible="{Binding IsCopying}"/>

                                                <Label Grid.Column="2" Grid.Row="0"
                                                       Text="{Binding RetryAttempt, StringFormat='Retry {0}...'}"
                                                       FontSize="11"
                                                       TextColor="{AppThemeBinding Light=#F59E0B, Dark=#FBBF24}"
                                                       HorizontalOptions="End"
                                                       VerticalOptions="Center"
                                                       FontAttributes="Bold"
                                                       IsVisible="{Binding IsRetrying}"/>
                                                
                                                <!-- Completed Checkmark -->
                                                <Label Grid.Column="2" Grid.Row="0"
                                                       Text="âœ“"
                                                       FontSize="16"
                                                       TextColor="{AppThemeBinding Light=#10B981, Dark=#34D399}"
                                                       HorizontalOptions="End"
                                                       VerticalOptions="Center"
                                                       IsVisible="{Binding IsCompleted}"/>

                                                <!-- Progress Bar -->
                                                <ProgressBar Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1"
                                                           Progress="{Binding Progress, Converter={StaticResource PercentToProgressConverter}}"
                                                           HeightRequest="4"
                                                           Margin="0,4,0,0"
                                                           IsVisible="{Binding IsCopying}"
                                                           ProgressColor="{AppThemeBinding Light=#0078D4, Dark=#60A5FA}"/>

                                                <!-- Retry Progress Bar (Indeterminate) -->
                                                <Border Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1"
                                                        HeightRequest="4"
                                                        Margin="0,4,0,0"
                                                        IsVisible="{Binding IsRetrying}"
                                                        BackgroundColor="{AppThemeBinding Light=#FEF3C7, Dark=#78350F}">
                                                    <Border.StrokeShape>
                                                        <RoundRectangle CornerRadius="2"/>
                                                    </Border.StrokeShape>
                                                    <Label Text="â³ Retrying..."
                                                           FontSize="9"
                                                           TextColor="{AppThemeBinding Light=#F59E0B, Dark=#FBBF24}"
                                                           HorizontalOptions="Center"
                                                           VerticalOptions="Center"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </ScrollView>
                    </Grid>

                    <!-- Source Path Footer -->
                    <Border Grid.Row="2"
                            BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#252525}"
                            Padding="10,8"
                            IsVisible="{Binding SourcePath, Converter={StaticResource IsStringNotNullOrEmptyConverter}}">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="{Binding SourcePath, StringFormat='ðŸ“‚ {0}'}"
                                   FontSize="11"
                                   LineBreakMode="TailTruncation"
                                   VerticalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"/>
                            <Button Grid.Column="1"
                                    Text="Clear"
                                    Command="{Binding ClearSourceCommand}"
                                    FontSize="10"
                                    Padding="8,4"
                                    BackgroundColor="{AppThemeBinding Light=#E5E5E5, Dark=#3A3A3A}"
                                    TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                                    CornerRadius="4"
                                    Margin="8,0,0,0"
                                    VerticalOptions="Center"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Operation Type Selector -->
            <Grid Grid.Column="1" RowDefinitions="Auto,15,*" Padding="15,3,15,0">

                <!-- Dropdown at top -->
                <Picker Grid.Row="0"
                        Title="Click to select operation type..."
                        SelectedIndex="-1"
                        FontSize="13"
                        HorizontalOptions="Fill"
                        SelectedIndexChanged="OnOperationChanged">
                    <Picker.Items>
                        <x:String>Copy</x:String>
                        <x:String>Move</x:String>
                        <x:String>Sync</x:String>
                        <x:String>Mirror</x:String>
                        <x:String>BiDirectionalSync</x:String>
                    </Picker.Items>
                </Picker>

                <!-- Spacer -->
                <!-- Grid.Row="1" is the spacer -->

                <!-- Description Pane -->
                <Border Grid.Row="2"
                        BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#2C2C2E}"
                        Stroke="{AppThemeBinding Light=#DEE2E6, Dark=#3C3C3E}"
                        StrokeThickness="1"
                        Padding="0"
                        VerticalOptions="Fill">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8"/>
                    </Border.StrokeShape>

                    <Grid RowDefinitions="Auto,*">
                        <!-- Header -->
                        <Border Grid.Row="0"
                                BackgroundColor="{AppThemeBinding Light=#6C757D, Dark=#48484A}"
                                Padding="12,10">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="8,8,0,0"/>
                            </Border.StrokeShape>
                            <Label Text="Operation Type Description"
                                   FontSize="13"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   HorizontalOptions="Center"/>
                        </Border>

                        <!-- Content Area -->
                        <VerticalStackLayout Grid.Row="1" Padding="15" Spacing="12">

                            <!-- Operation Description -->
                            <Label Text="{Binding OperationDescription}"
                                   FontSize="12"
                                   LineBreakMode="WordWrap"
                                   TextColor="{AppThemeBinding Light=#495057, Dark=#AEAEB2}"/>

                            <!-- Warning Box (for destructive operations) -->
                            <Border IsVisible="{Binding ShowOperationWarning}"
                                    BackgroundColor="{AppThemeBinding Light=#FEE, Dark=#4A1515}"
                                    Stroke="{AppThemeBinding Light=#DC3545, Dark=#DC3545}"
                                    StrokeThickness="2"
                                    Padding="12">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="6"/>
                                </Border.StrokeShape>
                                <VerticalStackLayout Spacing="6">
                                    <Label Text="âš ï¸ CAUTION"
                                           FontSize="11"
                                           FontAttributes="Bold"
                                           TextColor="{AppThemeBinding Light=#DC3545, Dark=#FF6B6B}"
                                           HorizontalOptions="Center"/>
                                    <Label Text="{Binding OperationWarningMessage}"
                                           FontSize="11"
                                           LineBreakMode="WordWrap"
                                           TextColor="{AppThemeBinding Light=#721C24, Dark=#FFC9C9}"
                                           HorizontalTextAlignment="Center"/>
                                </VerticalStackLayout>
                            </Border>

                        </VerticalStackLayout>
                    </Grid>
                </Border>
            </Grid>

            <!-- Destination Pane -->
            <Border x:Name="DestinationBorder"
                    Grid.Column="2"
                    BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                    Stroke="{AppThemeBinding Light=#10B981, Dark=#34D399}"
                    StrokeThickness="2"
                    Padding="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8"/>
                </Border.StrokeShape>
                <!-- Drag-drop handled by native Windows implementation in code-behind -->

                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Header -->
                    <Grid Grid.Row="0"
                          BackgroundColor="{AppThemeBinding Light=#10B981, Dark=#065F46}"
                          Padding="15,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Label Grid.Column="0"
                               Text="COPIED FILES"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="White"/>
                        <Label Grid.Column="1"
                               Text="{Binding DestinationPaneHeader}"
                               FontSize="12"
                               TextColor="White"
                               VerticalOptions="Center"/>
                    </Grid>

                    <!-- File List or Empty State -->
                    <Grid Grid.Row="1">
                        <!-- Empty State - No Destination Selected -->
                        <VerticalStackLayout IsVisible="{Binding DestinationPath, Converter={StaticResource IsStringNotNullOrEmptyConverter}, ConverterParameter=inverse}"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Padding="20">
                            <Label Text="ðŸ“‹"
                                   FontSize="48"
                                   HorizontalOptions="Center"
                                   Margin="0,0,0,10"/>
                            <Label Text="Drag &amp; Drop Destination Location Here"
                                   FontSize="16"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"/>
                            <Label Text="or"
                                   FontSize="14"
                                   HorizontalOptions="Center"
                                   Margin="0,5,0,5"
                                   TextColor="{AppThemeBinding Light=#888888, Dark=#AAAAAA}"/>
                            <Button Text="Select Destination Folder"
                                    Command="{Binding SelectDestinationCommand}"
                                    HorizontalOptions="Center"
                                    BackgroundColor="{AppThemeBinding Light=#10B981, Dark=#34D399}"
                                    TextColor="White"/>
                        </VerticalStackLayout>

                        <!-- Empty State - Destination Set But No Files Copied Yet -->
                        <VerticalStackLayout VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Padding="20">
                            <VerticalStackLayout.IsVisible>
                                <MultiBinding Converter="{StaticResource AllTrueConverter}">
                                    <Binding Path="DestinationPath" Converter="{StaticResource IsStringNotNullOrEmptyConverter}" />
                                    <Binding Path="DestinationFiles.Count" Converter="{StaticResource CountToVisibilityConverter}" ConverterParameter="inverse" />
                                </MultiBinding>
                            </VerticalStackLayout.IsVisible>
                            <Label Text="âœ“"
                                   FontSize="48"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#10B981, Dark=#34D399}"
                                   Margin="0,0,0,10"/>
                            <Label Text="Destination Set"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#10B981, Dark=#34D399}"/>
                            <Label Text="Drag &amp; Drop or Click Button to Change It"
                                   FontSize="14"
                                   HorizontalOptions="Center"
                                   Margin="0,10,0,10"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"/>
                            <Button Text="Change Destination Folder"
                                    Command="{Binding SelectDestinationCommand}"
                                    HorizontalOptions="Center"
                                    BackgroundColor="{AppThemeBinding Light=#10B981, Dark=#34D399}"
                                    TextColor="White"/>
                        </VerticalStackLayout>

                        <!-- File List -->
                        <ScrollView VerticalScrollBarVisibility="Default"
                                    HorizontalScrollBarVisibility="Never"
                                    IsVisible="{Binding DestinationFiles.Count, Converter={StaticResource CountToVisibilityConverter}}">
                            <CollectionView ItemsSource="{Binding DestinationFiles}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate x:DataType="models:FileItem">
                                        <Border BackgroundColor="{AppThemeBinding Light=#F0FDF4, Dark=#064E3B}"
                                                Margin="5,2"
                                                Padding="10,8">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="4"/>
                                            </Border.StrokeShape>
                                            <Grid ColumnDefinitions="*,Auto,Auto">
                                                <Label Grid.Column="0"
                                                       Text="{Binding FileName}"
                                                       FontSize="13"
                                                       LineBreakMode="TailTruncation"
                                                       VerticalOptions="Center"/>
                                                <Label Grid.Column="1"
                                                       Text="{Binding FormattedSize}"
                                                       FontSize="11"
                                                       TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                                                       VerticalOptions="Center"
                                                       Margin="10,0"/>
                                                <Label Grid.Column="2"
                                                       Text="âœ“"
                                                       FontSize="16"
                                                       TextColor="{AppThemeBinding Light=#10B981, Dark=#34D399}"
                                                       VerticalOptions="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </ScrollView>
                    </Grid>

                    <!-- Destination Path Footer -->
                    <Border Grid.Row="2"
                            BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#252525}"
                            Padding="10,8"
                            IsVisible="{Binding DestinationPath, Converter={StaticResource IsStringNotNullOrEmptyConverter}}">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="{Binding DestinationPath, StringFormat='ðŸ“‚ {0}'}"
                                   FontSize="11"
                                   LineBreakMode="TailTruncation"
                                   VerticalOptions="Center"
                                   TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"/>
                            <Button Grid.Column="1"
                                    Text="Clear"
                                    Command="{Binding ClearDestinationCommand}"
                                    FontSize="10"
                                    Padding="8,4"
                                    BackgroundColor="{AppThemeBinding Light=#E5E5E5, Dark=#3A3A3A}"
                                    TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                                    CornerRadius="4"
                                    Margin="8,0,0,0"
                                    VerticalOptions="Center"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!-- Summary View (Visible during copy) - Compact Version -->
        <Border Grid.Row="1" Margin="0,0,0,10" IsVisible="{Binding IsCopying}"
                BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                Stroke="{AppThemeBinding Light=#DDDDDD, Dark=#444444}"
                StrokeThickness="2"
                Padding="20,15">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="20">
                <VerticalStackLayout Grid.Column="0" Spacing="3">
                    <Label Text="Completed"
                           FontSize="11"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                           HorizontalOptions="Center"/>
                    <Label Text="{Binding FilesCompleted, StringFormat='{0:N0}'}"
                           FontSize="28"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light=#10B981, Dark=#34D399}"/>
                    <Label Text="{Binding TotalSourceFileCount, StringFormat='of {0:N0} files'}"
                           FontSize="11"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1" Spacing="3">
                    <Label Text="In Progress"
                           FontSize="11"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                           HorizontalOptions="Center"/>
                    <Label Text="{Binding FilesInProgress, StringFormat='{0}'}"
                           FontSize="28"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light=#F59E0B, Dark=#FBBF24}"/>
                    <Label Text="active"
                           FontSize="11"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="2" Spacing="3">
                    <Label Text="Remaining"
                           FontSize="11"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                           HorizontalOptions="Center"/>
                    <Label Text="{Binding FilesRemaining, StringFormat='{0:N0}'}"
                           FontSize="28"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"/>
                    <Label Text="files"
                           FontSize="11"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Grid>
        </Border>

        <!-- Strategy Information Panel (Visible when strategy is selected) -->
        <Border Grid.Row="2" Margin="0,0,0,10" IsVisible="{Binding ShowStrategyInfo}"
                BackgroundColor="{AppThemeBinding Light=#F8FAFC, Dark=#1E293B}"
                Stroke="{AppThemeBinding Light=#E2E8F0, Dark=#334155}"
                StrokeThickness="2"
                Padding="20">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="8"/>
            </Border.StrokeShape>
            <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="15">
                <!-- Strategy Header -->
                <HorizontalStackLayout Grid.Row="0" Spacing="10">
                    <Label Text="{Binding StrategyEmoji}"
                           FontSize="24"
                           VerticalOptions="Center"/>
                    <VerticalStackLayout Spacing="2">
                        <Label Text="Transfer Strategy"
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}"/>
                        <Label Text="{Binding StrategyName}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#0F172A, Dark=#F1F5F9}"/>
                    </VerticalStackLayout>
                </HorizontalStackLayout>

                <!-- Storage Profiles -->
                <Grid Grid.Row="1" ColumnDefinitions="*,Auto,*" ColumnSpacing="15">
                    <!-- Source Storage -->
                    <Border Grid.Column="0"
                            BackgroundColor="{AppThemeBinding Light=#DBEAFE, Dark=#1E3A8A}"
                            Padding="12,10">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="6"/>
                        </Border.StrokeShape>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Source Storage"
                                   FontSize="10"
                                   TextColor="{AppThemeBinding Light=#1E40AF, Dark=#93C5FD}"/>
                            <Label Text="{Binding SourceStorageType}"
                                   FontSize="13"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#1E3A8A, Dark=#BFDBFE}"/>
                            <Label Text="{Binding SourceStorageSpeed}"
                                   FontSize="11"
                                   TextColor="{AppThemeBinding Light=#3B82F6, Dark=#93C5FD}"/>
                        </VerticalStackLayout>
                    </Border>

                    <!-- Arrow -->
                    <Label Grid.Column="1"
                           Text="â†’"
                           FontSize="24"
                           VerticalOptions="Center"
                           TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}"/>

                    <!-- Destination Storage -->
                    <Border Grid.Column="2"
                            BackgroundColor="{AppThemeBinding Light=#D1FAE5, Dark=#065F46}"
                            Padding="12,10">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="6"/>
                        </Border.StrokeShape>
                        <VerticalStackLayout Spacing="4">
                            <Label Text="Destination Storage"
                                   FontSize="10"
                                   TextColor="{AppThemeBinding Light=#047857, Dark=#6EE7B7}"/>
                            <Label Text="{Binding DestStorageType}"
                                   FontSize="13"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#065F46, Dark=#A7F3D0}"/>
                            <Label Text="{Binding DestStorageSpeed}"
                                   FontSize="11"
                                   TextColor="{AppThemeBinding Light=#059669, Dark=#6EE7B7}"/>
                        </VerticalStackLayout>
                    </Border>
                </Grid>

                <!-- Strategy Details -->
                <VerticalStackLayout Grid.Row="2" Spacing="8">
                    <HorizontalStackLayout Spacing="6">
                        <Label Text="ðŸ’¡"
                               FontSize="14"/>
                        <Label Text="{Binding StrategyReasoning}"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light=#475569, Dark=#CBD5E1}"
                               LineBreakMode="WordWrap"/>
                    </HorizontalStackLayout>

                    <!-- Compression Badge -->
                    <HorizontalStackLayout Spacing="6" IsVisible="{Binding CompressionEnabled}">
                        <Label Text="ðŸ—œï¸"
                               FontSize="14"/>
                        <Border BackgroundColor="{AppThemeBinding Light=#FEF3C7, Dark=#78350F}"
                                Padding="8,4">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="4"/>
                            </Border.StrokeShape>
                            <Label Text="{Binding CompressionInfo}"
                                   FontSize="11"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#92400E, Dark=#FDE68A}"/>
                        </Border>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Grid>
        </Border>

        <!-- Progress Section (Only visible when copying) -->
        <VerticalStackLayout Grid.Row="3" Spacing="10" Margin="0,0,0,20" IsVisible="{Binding IsCopying}">

            <!-- Current File Info (Compact) -->
            <Border BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2A2A2A}"
                    Padding="12,8">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="4"/>
                </Border.StrokeShape>
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                    <Label Grid.Column="0"
                           Text="Current:"
                           FontSize="11"
                           TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                           VerticalOptions="Center"/>
                    <Label Grid.Column="1"
                           Text="{Binding CurrentFileName}"
                           FontSize="12"
                           LineBreakMode="TailTruncation"
                           VerticalOptions="Center"/>
                    <Label Grid.Column="2"
                           Text="{Binding CurrentFileProgress, StringFormat='{0:F0}%'}"
                           FontSize="11"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#0078D4, Dark=#60A5FA}"
                           VerticalOptions="Center"
                           IsVisible="{Binding ShowIndividualFileProgress}"/>
                </Grid>
            </Border>

            <!-- Overall Progress -->
            <Border BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#252525}"
                    Stroke="{AppThemeBinding Light=#DDDDDD, Dark=#444444}"
                    StrokeThickness="1"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="6"/>
                </Border.StrokeShape>
                <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="8">
                    <Label Grid.Row="0"
                           Text="Overall Progress"
                           FontSize="14"
                           FontAttributes="Bold"/>

                    <ProgressBar Grid.Row="1"
                                 Progress="{Binding OverallProgress, Converter={StaticResource PercentToProgressConverter}}"
                                 HeightRequest="12"
                                 ProgressColor="{AppThemeBinding Light=#0078D4, Dark=#60A5FA}"/>

                    <Label Grid.Row="2"
                           Text="{Binding OverallProgress, StringFormat='{0:F1}%'}"
                           HorizontalOptions="Center"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#0078D4, Dark=#60A5FA}"/>

                    <!-- Speed and Stats -->
                    <Grid Grid.Row="3" ColumnDefinitions="*,*,*">
                        <Label Grid.Column="0"
                               Text="{Binding CurrentSpeed, StringFormat='Speed: {0}'}"
                               FontSize="11"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                               HorizontalOptions="Start"/>

                        <Label Grid.Column="1"
                               Text="{Binding AverageSpeed, StringFormat='Avg: {0}'}"
                               FontSize="11"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                               HorizontalOptions="Center"/>

                        <Label Grid.Column="2"
                               Text="{Binding EstimatedTimeRemaining, StringFormat='ETA: {0}'}"
                               FontSize="11"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                               HorizontalOptions="End"/>
                    </Grid>
                </Grid>
            </Border>

            <!-- Compression Stats (Visible when compression is active) -->
            <Border IsVisible="{Binding CompressionEnabled}"
                    BackgroundColor="{AppThemeBinding Light=#FFFBEB, Dark=#78350F}"
                    Stroke="{AppThemeBinding Light=#FDE68A, Dark=#92400E}"
                    StrokeThickness="1"
                    Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="6"/>
                </Border.StrokeShape>
                <Grid RowDefinitions="Auto,Auto" RowSpacing="8">
                    <HorizontalStackLayout Grid.Row="0" Spacing="8">
                        <Label Text="ðŸ—œï¸"
                               FontSize="16"
                               VerticalOptions="Center"/>
                        <Label Text="Compression Active"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#92400E, Dark=#FDE68A}"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <Grid Grid.Row="1" ColumnDefinitions="*,*,*">
                        <VerticalStackLayout Grid.Column="0" Spacing="2">
                            <Label Text="Compression Ratio"
                                   FontSize="10"
                                   TextColor="{AppThemeBinding Light=#92400E, Dark=#FDE68A}"/>
                            <Label Text="{Binding OverallCompressionRatio, StringFormat='{0:F2}x'}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#78350F, Dark=#FEF3C7}"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" Spacing="2" HorizontalOptions="Center">
                            <Label Text="Bandwidth Saved"
                                   FontSize="10"
                                   TextColor="{AppThemeBinding Light=#92400E, Dark=#FDE68A}"/>
                            <Label Text="{Binding BandwidthSaved}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#78350F, Dark=#FEF3C7}"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="2" Spacing="2" HorizontalOptions="End">
                            <Label Text="Compressed"
                                   FontSize="10"
                                   TextColor="{AppThemeBinding Light=#92400E, Dark=#FDE68A}"/>
                            <Label Text="{Binding TotalCompressedBytes, Converter={StaticResource BytesToStringConverter}}"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#78350F, Dark=#FEF3C7}"/>
                        </VerticalStackLayout>
                    </Grid>
                </Grid>
            </Border>
        </VerticalStackLayout>

        <!-- Control Button (Single button that toggles between Start Copy and Cancel) -->
        <Grid Grid.Row="4" Margin="0,0,0,20" IsVisible="{Binding ShowStartButton}">
            <Button Text="{Binding CopyButtonText}"
                    Command="{Binding StartCopyCommand}"
                    BackgroundColor="{Binding CopyButtonColor}"
                    TextColor="White"
                    FontAttributes="Bold"
                    FontSize="16"
                    HeightRequest="50"
                    CornerRadius="8"
                    HorizontalOptions="Fill"/>
        </Grid>

        <!-- Debug Log (temporary) -->
        <Border Grid.Row="5"
                BackgroundColor="{AppThemeBinding Light=#FAFAFA, Dark=#1E1E1E}"
                Stroke="{AppThemeBinding Light=#CCCCCC, Dark=#444444}"
                StrokeThickness="1"
                HeightRequest="100"
                Margin="0,10,0,0"
                Padding="10">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="4"/>
            </Border.StrokeShape>
            <Grid RowDefinitions="Auto,*">
                <!-- Header -->
                <Label Grid.Row="0"
                       Text="Debug Log:" 
                       FontSize="10" 
                       FontAttributes="Bold"
                       Margin="0,0,0,5"/>
                
                <!-- Log content -->
                <ScrollView Grid.Row="1"
                            VerticalScrollBarVisibility="Default"
                            HorizontalScrollBarVisibility="Never">
                    <CollectionView ItemsSource="{Binding LogMessages}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Label Text="{Binding}"
                                       FontSize="9"
                                       FontFamily="Consolas,monospace"
                                       Padding="2"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </ScrollView>
            </Grid>
        </Border>

        <!-- Export Log Button -->
        <Button Grid.Row="6"
                Text="Export Log"
                Command="{Binding ExportLogCommand}"
                FontSize="9"
                Padding="8,4"
                BackgroundColor="{AppThemeBinding Light=#E5E5E5, Dark=#3A3A3A}"
                TextColor="{AppThemeBinding Light=#666666, Dark=#999999}"
                CornerRadius="3"
                HorizontalOptions="End"
                Margin="0,5,0,0"/>

    </Grid>
</ContentPage>
